<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GET Social Media Index</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
    <!-- Facebook Javascript SDK Script -->
    <script>
        window.fbAsyncInit = function() {
          FB.init({
            appId            : '1601234713231184',
            autoLogAppEvents : true,
            xfbml            : true,
            version          : 'v2.10'
          });
          FB.AppEvents.logPageView();
        };
      
        (function(d, s, id){
           var js, fjs = d.getElementsByTagName(s)[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement(s); js.id = id;
           js.src = "https://connect.facebook.net/en_US/sdk.js";
           fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'facebook-jssdk'));

         function getLikesCount() {
             FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    getLikes()
                }
                else {
                    FB.login(function() {
                        getLikes();
                    });
                }
            });
         }
         
         function getLikes() {
             FB.api('', 'post', {
                 batch: [
                     { method: 'get', relative_url:'TheGUIDON/?fields=fan_count'},
                     { method: 'get', relative_url:'TheGUIDONSports/?fields=fan_count'},
                     { method: 'get', relative_url:'VantMag/?fields=fan_count'}
                 ]
             }, function(resArray) {
                 var refArray = ["The GUIDON Main", "GUIDON Sports", "Vantage Magazine"];
                    resArray.map(function(res, index) {
                        var fanCount = -1; // -1 means not yet filled out
                        var name = refArray[index];
                        
                        fanCount = JSON.parse(res.body).fan_count;

                        addEntry(refArray[index], fanCount);
                    })
             })
         }
         
         function addEntry(pageName, likes) {
            var newRow = document.createElement("tr");
            
            // Create td and Append page name
            var pageNameCell = document.createElement("td");
            pageNameCell.innerText = pageName;
            
            var likesCountCell = document.createElement("td");
            likesCountCell.innerText = likes;

            newRow.appendChild(pageNameCell);
            newRow.appendChild(likesCountCell);

            // Append likes count as td

            document.querySelector('#out').appendChild(newRow);
         }
      </script>
      
        <div class="container">
            <h1>Social Media Index Tracker</h1>
            <table id="out" class="table table-bordered">
                <tr>
                    <th>Page</th>
                    <th>Likes</th>
                </tr>
            </table>
            <button onclick="getLikesCount()">Get Likes Count</button>
        </div>
</body>
</html>